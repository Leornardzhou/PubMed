---
title: "PubMed Retractions report compiled `r Sys.time()`"
author: "Neil Saunders"
date: 
output: html_document
---

```{r echo=FALSE, ref.label="setup", message=FALSE}
```

## Introduction


## 1. Timeline
Where is this text?

```{r chart1, message=FALSE, echo=FALSE, results='asis', warning=FALSE}
setwd("~/Dropbox/projects/pubmed/retractions/data")
doc <- xmlTreeParse("retracted.xml", useInternalNodes = TRUE)
dates <- xpathSApply(doc, "//MedlineCitation/DateCreated", xmlValue)
dates <- as.Date(dates, "%Y%m%d")
df1 <- as.data.frame(table(cut(dates, breaks = "year")), stringsAsFactors = FALSE)

h1 <- Highcharts$new()
h1$series(data = df1$Freq, type = "column")
h1$xAxis(categories = df1$Var1, labels = list(rotation = 90))
h1$legend(enabled = FALSE)
h1$show('inline', cdn = FALSE, include_assets = TRUE)
```

## 2. Cumulative
```{r chart2, message=FALSE, echo=FALSE, results='asis', warning=FALSE}
h1 <- Highcharts$new()
h1$series(data = cumsum(df1$Freq), type = "column")
h1$xAxis(categories = df1$Var1, labels = list(rotation = 90))
h1$legend(enabled = FALSE)
h1$show('inline', cdn = FALSE, include_assets = TRUE)
```

## 3. By Year
```{r chart3, message=FALSE, echo=FALSE, results='asis', warning=FALSE}
setwd("~/Dropbox/projects/pubmed/retractions/data")
y <- read.csv("years.csv")
h2 <- Highcharts$new()
h2$series(data = (100000 / y$total) * y$retracted, type = "column", events = list(click = "#! function() {window.open(this.options.url)} !#"))
h2$xAxis(categories = y$year, labels = list(rotation = 90))
h2$legend(enabled = FALSE)
h2$show('inline', cdn = FALSE, include_assets = TRUE)
```


## 4. By Journal
```{r chart4, message=FALSE, echo=FALSE, results='asis', warning=FALSE}
setwd("~/Dropbox/projects/pubmed/retractions/data")
j20 <- read.csv("journals.csv")
h4 <- Highcharts$new()
h4$chart(marginLeft = 220)
h4$series(data = j20$count, type = "bar")
h4$xAxis(categories = j20$journal, labels = list(formatter = "#! function() { return '<a href=\"http://www.pubmed.org/?term=%22Retracted Publication%22[PTYP] AND %22' + escape(this.value) + '%22[JOUR]\" target=\"_blank\">' + this.value + '</a>'; } !#", useHTML = "true"))
h4$legend(enabled = FALSE)
h4$show('inline', cdn = FALSE, include_assets = TRUE)
```

## 5. Functions

### 5.1 Setup
```{r setup, tidy=TRUE, warning=FALSE, cache=TRUE, eval=FALSE}
library(rCharts)
library(rentrez)
library(XML)
library(lubridate)
```

### 5.2 Timeline

### 5.3 By Year

### 5.4 Cumulative

### 5.5 By Journal
